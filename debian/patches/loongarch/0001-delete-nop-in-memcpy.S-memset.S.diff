From 6f52ffa05d3799037276a44c970ba68cc62193c1 Mon Sep 17 00:00:00 2001
From: chenglulu <chenglulu@loongson.cn>
Date: Tue, 17 Nov 2020 10:19:38 +0800
Subject: [PATCH] delete nop in memcpy.S memset.S.

---
 sysdeps/loongarch/lp64/memcpy.S | 27 ---------------------------
 sysdeps/loongarch/lp64/memset.S | 22 ----------------------
 2 files changed, 49 deletions(-)

diff --git a/sysdeps/loongarch/lp64/memcpy.S b/sysdeps/loongarch/lp64/memcpy.S
index 1302ec3a04..0add236f4e 100644
--- a/sysdeps/loongarch/lp64/memcpy.S
+++ b/sysdeps/loongarch/lp64/memcpy.S
@@ -50,13 +50,10 @@ LEAF(MEMCPY_NAME)
 	move	t8, a0
 	srai.d	a6, a2, 4  		#num/16
 	beqz	a6, less_16bytes        #num<16
-	nop
 	srai.d	a6, a2, 8  		#num/256
 	bnez	a6, more_256bytes       #num>256
-	nop
 	srai.d	a6, a2, 7  
 	beqz	a6, less_128bytes	#num<128
-	nop
 
 	LD_64(a1, 0)			#128<num<256
 	ST_64(a0, 0)
@@ -68,12 +65,10 @@ LEAF(MEMCPY_NAME)
 	ST_64(a3, -64)
 
 	jr	ra
-	nop
 
 less_128bytes:
 	srai.d	a6, a2, 6  #num/64
 	beqz	a6, less_64bytes
-	nop
 
 	LD_64(a1, 0)
 	ST_64(a0, 0)
@@ -81,12 +76,10 @@ less_128bytes:
 	ST_64(a3, -64)
 	
 	jr	ra
-	nop
 
 less_64bytes:
 	srai.d	a6, a2, 5 #num/32
 	beqz	a6, less_32bytes
-	nop
 	
 	ld.d	t0, a1, 0
 	ld.d	t1, a1, 8
@@ -106,7 +99,6 @@ less_64bytes:
 	st.d	t7, a3, -8
 
 	jr	ra
-	nop
 
 less_32bytes:
 	ld.d	t0, a1, 0
@@ -119,12 +111,10 @@ less_32bytes:
 	st.d	t3, a3, -8
 
 	jr	ra
-	nop
 
 less_16bytes:
 	srai.d	a6, a2, 3 #num/8
 	beqz	a6, less_8bytes
-	nop
 	
 	ld.d	t0, a1, 0
 	ld.d	t1, a4, -8
@@ -132,12 +122,10 @@ less_16bytes:
 	st.d	t1, a3, -8
 
 	jr	ra
-	nop
 
 less_8bytes:
 	srai.d	a6, a2, 2
 	beqz	a6, less_4bytes
-	nop
 
 	ld.w	t0, a1, 0
 	ld.w	t1, a4, -4
@@ -145,12 +133,10 @@ less_8bytes:
 	st.w	t1, a3, -4
 
 	jr	ra
-	nop
 	
 less_4bytes:
 	srai.d	a6, a2, 1
 	beqz	a6, less_2bytes
-	nop
 	
 	ld.h	t0, a1, 0
 	ld.h	t1, a4, -2
@@ -158,21 +144,17 @@ less_4bytes:
 	st.h	t1, a3, -2
 
 	jr	ra
-	nop
 
 less_2bytes:
 	beqz	a2, less_1bytes
-	nop
 
 	ld.b	t0, a1, 0
 	st.b	t0, a0, 0
 
 	jr	ra
-	nop
 
 less_1bytes:
 	jr	ra
-	nop
 
 more_256bytes:
 	srli.d	a0, a0, 3
@@ -192,10 +174,8 @@ more_256bytes:
 	addi.d	a7, a7, -0x80     
 	srai.d	a6, a7, 22    
 	bnez	a6, loop_most
-	nop
 	srai.d	a6, a7, 12
 	beqz	a6, loop_less
-	nop
 
 loop_more:
 	addi.d	a5, zero, 4
@@ -266,17 +246,14 @@ loop_in_1:
 
 	addi.d	a5, a5, -1
 	bnez	a5, loop_in_1
-	nop
 	addi.d	a6, a6, -1
 	bnez	a6, loop_more
-	nop
 
  	lu12i.w t4, 1
   	addi.d 	t4, t4, -1 
   	and 	a7, a7, t4
 	
 	b	loop_less
-	nop
 
 loop_most:
 	srai.d	a6, a7, 12
@@ -385,10 +362,8 @@ loop_in_2:
    	addi.d  a3,  a3,   128
 	addi.d	a5, a5, -1
 	bnez	a5, loop_in_2
-	nop
 	addi.d	a6, a6, -1
 	bnez	a6, loop_most_loop
-	nop
 
  	lu12i.w t4, 1
   	addi.d 	t4, t4, -1 
@@ -404,10 +379,8 @@ loop_less:
 	addi.d	a7,  a7, -0x80
 	slt	a6, a7, zero
 	beqz	a6, loop_less
-	nop
 	move	v0, t8
 	jr	ra
-	nop
 
 END(MEMCPY_NAME)
 #ifndef ANDROID_CHANGES
diff --git a/sysdeps/loongarch/lp64/memset.S b/sysdeps/loongarch/lp64/memset.S
index fa2eef945f..639e6774b0 100644
--- a/sysdeps/loongarch/lp64/memset.S
+++ b/sysdeps/loongarch/lp64/memset.S
@@ -29,13 +29,10 @@ memset:
 	bstrins.d a1, a1, 63, 32
 	srai.d	  t8, a2, 4         	#num/16
 	beqz	  t8, less_16bytes	#num<16
-	nop
 	srai.d	  t8, a2, 8		#num/256
 	bnez	  t8, more_256bytes	#num>256
-	nop
 	srai.d	  t8, a2, 7		#num/128
 	beqz	  t8, less_128bytes	#num<128
-	nop
 	st.d	  a1, a0, 0		#128<num<256
 	st.d	  a1, a0, 8
 	st.d	  a1, a0, 16
@@ -70,12 +67,10 @@ memset:
 	st.d	  a1, t7, -8
 
 	jr	  ra
-	nop
 
 less_128bytes:
 	srai.d	  t8, a2, 6		#num/64
 	beqz	  t8, less_64bytes
-	nop
 	st.d	  a1, a0, 0
 	st.d	  a1, a0, 8
 	st.d	  a1, a0, 16
@@ -94,12 +89,10 @@ less_128bytes:
 	st.d	  a1, t7, -8
 	
 	jr	  ra
-	nop
 
 less_64bytes:
 	srai.d	  t8, a2, 5		#num/32
 	beqz	  t8, less_32bytes
-	nop
 	st.d	  a1, a0, 0
 	st.d	  a1, a0, 8
 	st.d	  a1, a0, 16
@@ -110,7 +103,6 @@ less_64bytes:
 	st.d	  a1, t7, -8
 
 	jr	  ra
-	nop
 
 less_32bytes:
 	st.d	  a1, a0, 0
@@ -119,49 +111,39 @@ less_32bytes:
 	st.d	  a1, t7, -8
 	
 	jr	  ra
-	nop
 
 less_16bytes:
 	srai.d	  t8, a2, 3		#num/8
 	beqz	  t8, less_8bytes
-	nop
 	st.d	  a1, a0, 0
 	st.d	  a1, t7, -8
 	
 	jr	  ra
-	nop
 
 less_8bytes:
 	srai.d	  t8, a2, 2
 	beqz	  t8, less_4bytes
-	nop
 	st.w	  a1, a0, 0
 	st.w	  a1, t7, -4
 
 	jr	  ra
-	nop
 
 less_4bytes:
 	srai.d	  t8, a2, 1
 	beqz	  t8, less_2bytes
-	nop
 	st.h	  a1, a0, 0
 	st.h	  a1, t7, -2
 
 	jr	  ra
-	nop
 
 less_2bytes:
 	beqz	  a2, less_1bytes
-	nop
 	st.b	  a1, a0, 0
 	
 	jr	  ra
-	nop
 
 less_1bytes:
 	jr	  ra
-	nop
 
 more_256bytes:
 	srli.d	  a0, a0, 3
@@ -173,7 +155,6 @@ more_256bytes:
 	addi.d	  t2, t2, -0x80
 	srai.d	  t8, t2, 12
 	beqz	  t8, loop_less
-	nop
 
 loop_more:
 	addi.d	  t4, zero, 4
@@ -318,7 +299,6 @@ loop_in:
 	bnez	  t4, loop_in
 	addi.d	  t8, t8, -1
 	bnez	  t8, loop_more
-	nop
 	lu12i.w	  t3, 1
 	addi.d	  t3, t3, -1
 	and	  t2, t2, t3
@@ -344,7 +324,6 @@ loop_less:
 	addi.d	t2, t2, -0x80
 	slt	t8, t2, zero
 	beqz	t8, loop_less
-	nop
 	st.d	  a1, t7, -128
 	st.d	  a1, t7, -120
 	st.d	  a1, t7, -112
@@ -365,7 +344,6 @@ loop_less:
 	move	  v0, t0
 	
 	jr	  ra
-	nop
 
 END(MEMSET)
 
-- 
2.18.1

